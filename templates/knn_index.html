<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KNN Helm Classification</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .result-card {
            border-left: 4px solid #667eea;
        }
        .neighbor-card {
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg gradient-bg">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-motorcycle me-2"></i>KNN Helm Classifier</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row">
            <div class="col-md-4">
                <div class="card card-hover">
                    <div class="card-header gradient-bg">
                        <h5 class="card-title mb-0"><i class="fas fa-cog me-2"></i>Input Data Helm</h5>
                    </div>
                    <div class="card-body">
                        <form id="knnForm">
                            <div class="mb-3">
                                <label class="form-label">Harga (Rp)</label>
                                <input type="number" class="form-control" id="harga" required 
                                       placeholder="contoh: 500000">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Standar Keamanan</label>
                                <select class="form-select" id="standar" required>
                                    <option value="">Pilih Standar</option>
                                    <option value="SNI">SNI</option>
                                    <option value="SNI, DOT">SNI, DOT</option>
                                    <option value="SNI, DOT, ECE">SNI, DOT, ECE</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Kaca</label>
                                <select class="form-select" id="kaca" required>
                                    <option value="">Ada Kaca?</option>
                                    <option value="Ya">Ya</option>
                                    <option value="No">Tidak</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Double Visor</label>
                                <select class="form-select" id="double_visor" required>
                                    <option value="">Ada Double Visor?</option>
                                    <option value="Ya">Ya</option>
                                    <option value="No">Tidak</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Berat (kg)</label>
                                <input type="number" class="form-control" id="berat" step="0.1" required 
                                       placeholder="contoh: 1.5">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label">Wire Lock</label>
                                <select class="form-select" id="wire_lock" required>
                                    <option value="">Ada Wire Lock?</option>
                                    <option value="Ya">Ya</option>
                                    <option value="No">Tidak</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-search me-2"></i>Prediksi Kelas
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Training Data Card -->
                <div class="card card-hover mt-3">
                    <div class="card-header gradient-bg">
                        <h6 class="card-title mb-0"><i class="fas fa-database me-2"></i>Training Data</h6>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-outline-primary btn-sm w-100" onclick="loadTrainingData()">
                            <i class="fas fa-eye me-2"></i>Lihat Data Training
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <!-- Result Card -->
                <div class="card result-card" id="resultCard" style="display: none;">
                    <div class="card-header">
                        <h5 class="card-title mb-0"><i class="fas fa-chart-line me-2"></i>Hasil Prediksi</h5>
                    </div>
                    <div class="card-body" id="resultContent">
                        <!-- Results will be displayed here -->
                    </div>
                </div>

                <!-- Training Data Display -->
                <div class="card" id="trainingCard" style="display: none;">
                    <div class="card-header">
                        <h5 class="card-title mb-0"><i class="fas fa-table me-2"></i>Data Training KNN</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-sm" id="trainingTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th>No</th>
                                        <th>Merk</th>
                                        <th>Nama</th>
                                        <th>Jenis</th>
                                        <th>Harga</th>
                                        <th>Standar</th>
                                        <th>Double Visor</th>
                                        <th>Berat</th>
                                        <th>Wire Lock</th>
                                        <th>Kelas</th>
                                    </tr>
                                </thead>
                                <tbody id="trainingBody">
                                    <!-- Training data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div class="text-center" id="loading" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Memproses prediksi...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('knnForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const data = {
                harga: document.getElementById('harga').value,
                standar: document.getElementById('standar').value,
                kaca: document.getElementById('kaca').value,
                double_visor: document.getElementById('double_visor').value,
                berat: document.getElementById('berat').value,
                wire_lock: document.getElementById('wire_lock').value
            };
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultCard').style.display = 'none';
            
            fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                
                if (data.status === 'success') {
                    displayResult(data.result);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                alert('Error: ' + error);
            });
        });

        function displayResult(result) {
            const prediction = result.prediction;
            const confidence = result.confidence;
            const neighbors = result.nearest_neighbors;
            
            let confidenceClass = prediction === 'Mahal' ? 'danger' : 'success';
            let icon = prediction === 'Mahal' ? 'fas fa-arrow-up' : 'fas fa-arrow-down';
            
            let html = `
                <div class="row">
                    <div class="col-md-6">
                        <div class="alert alert-${confidenceClass} text-center">
                            <i class="${icon} me-2"></i>
                            <h4>Prediksi: ${prediction}</h4>
                            <p class="mb-0">Confidence: ${(Math.max(confidence.Mahal, confidence.Murah) * 100).toFixed(1)}%</p>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <small>Detail Confidence</small>
                            </div>
                            <div class="card-body p-2">
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-danger" style="width: ${confidence.Mahal * 100}%">
                                        Mahal: ${(confidence.Mahal * 100).toFixed(1)}%
                                    </div>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-success" style="width: ${confidence.Murah * 100}%">
                                        Murah: ${(confidence.Murah * 100).toFixed(1)}%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <h6><i class="fas fa-users me-2"></i>K-Nearest Neighbors:</h6>
                        <div style="max-height: 300px; overflow-y: auto;">
            `;
            
            neighbors.forEach(neighbor => {
                let badgeClass = neighbor.kelas === 'Mahal' ? 'danger' : 'success';
                html += `
                    <div class="neighbor-card p-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${neighbor.merk} ${neighbor.nama}</strong><br>
                                <small class="text-muted">${neighbor.jenis} - Rp ${neighbor.harga.toLocaleString()}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-${badgeClass}">${neighbor.kelas}</span><br>
                                <small class="text-muted">Distance: ${neighbor.distance.toFixed(4)}</small>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('resultContent').innerHTML = html;
            document.getElementById('resultCard').style.display = 'block';
        }

        function loadTrainingData() {
            document.getElementById('trainingCard').style.display = 'none';
            
            fetch('/training_data')
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    displayTrainingData(data.data);
                } else {
                    alert('Error loading training data: ' + data.message);
                }
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }

        function displayTrainingData(data) {
            const tbody = document.getElementById('trainingBody');
            tbody.innerHTML = '';
            
            data.forEach(item => {
                let badgeClass = item.kelas === 'Mahal' ? 'danger' : 'success';
                let row = `
                    <tr>
                        <td>${item.no_data}</td>
                        <td>${item.merk}</td>
                        <td>${item.nama}</td>
                        <td>${item.jenis}</td>
                        <td>Rp ${item.harga.toLocaleString()}</td>
                        <td><small>${item.standar}</small></td>
                        <td>${item.double_visor}</td>
                        <td>${item.berat} kg</td>
                        <td>${item.wire_lock}</td>
                        <td><span class="badge bg-${badgeClass}">${item.kelas}</span></td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            document.getElementById('trainingCard').style.display = 'block';
        }
    </script>
</body>
</html>